<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>British Sugar App Hub</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }

  body {
    min-height: 100vh;
    background: #0f1117;
    color: #e2e4e9;
    font-family: 'Segoe UI', system-ui, sans-serif;
    padding: 32px 20px;
  }

  /* Ambient glows */
  .glow { position: fixed; border-radius: 50%; pointer-events: none; z-index: 0; }
  .glow-1 { top:-120px; left:-120px; width:400px; height:400px; background: radial-gradient(circle, rgba(99,102,241,0.18) 0%, transparent 70%); }
  .glow-2 { bottom:-80px; right:-80px; width:350px; height:350px; background: radial-gradient(circle, rgba(16,185,129,0.12) 0%, transparent 70%); }
  .glow-3 { top:50%; left:50%; transform:translate(-50%,-50%); width:600px; height:600px; background: radial-gradient(circle, rgba(139,92,246,0.06) 0%, transparent 70%); }

  .container { position: relative; z-index: 1; max-width: 900px; margin: 0 auto; }

  /* Header */
  .header { text-align: center; margin-bottom: 36px; }
  .header h1 {
    font-size: 28px; font-weight: 700; letter-spacing: -0.5px;
    background: linear-gradient(135deg, #e2e4e9 30%, #a5b4fc 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .header p { color: #6b7280; font-size: 14px; margin-top: 6px; }

  /* Export button */
  .export-btn {
    position: fixed; top: 20px; right: 20px; z-index: 100;
    background: rgba(139,92,246,0.15); border: 1px solid rgba(139,92,246,0.3);
    border-radius: 8px; padding: 8px 12px; cursor: pointer; color: #a5b4fc;
    display: flex; align-items: center; gap: 6px; font-size: 13px; transition: background 0.2s;
  }
  .export-btn:hover { background: rgba(139,92,246,0.25); }

  /* Modal */
  .modal-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7); z-index: 200;
    display: flex; align-items: center; justify-content: center;
    padding: 20px;
  }
  .modal {
    background: #1a1d2e; border: 1px solid rgba(255,255,255,0.1);
    border-radius: 16px; padding: 24px; max-width: 600px; width: 100%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }
  .modal h2 {
    font-size: 20px; margin-bottom: 16px; color: #e2e4e9;
  }
  .modal p {
    color: #9ca3af; font-size: 14px; margin-bottom: 16px; line-height: 1.5;
  }
  .modal textarea {
    width: 100%; height: 200px; padding: 12px;
    background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px; color: #e2e4e9; font-family: monospace; font-size: 12px;
    resize: vertical; outline: none;
  }
  .modal-actions {
    display: flex; gap: 8px; margin-top: 16px; justify-content: flex-end;
  }
  .modal .btn-primary {
    background: linear-gradient(135deg, #6366f1, #8b5cf6); border: none;
    border-radius: 8px; padding: 8px 16px; cursor: pointer; color: white;
    font-size: 13px; font-weight: 600;
  }
  .modal .btn-secondary {
    background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px; padding: 8px 16px; cursor: pointer; color: #9ca3af;
    font-size: 13px; font-weight: 600;
  }

  /* Search */
  .search-wrap { position: relative; margin-bottom: 28px; }
  .search-wrap svg { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #4b5563; pointer-events: none; }
  .search-wrap input {
    width: 100%; padding: 12px 16px 12px 40px;
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px; color: #e2e4e9; font-size: 15px; outline: none; transition: border-color 0.2s;
  }
  .search-wrap input:focus { border-color: rgba(139,92,246,0.5); }
  .search-wrap input::placeholder { color: #4b5563; }

  /* Category */
  .category { margin-bottom: 28px; }
  .cat-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; padding: 0 2px; }
  .cat-header-left { display: flex; align-items: center; gap: 10px; }
  .cat-header-left .emoji { font-size: 20px; }
  .cat-header-left .name { font-size: 15px; font-weight: 600; color: #c4c8d4; letter-spacing: 0.3px; }
  .cat-header-left .count { font-size: 11px; color: #4b5563; background: rgba(255,255,255,0.06); padding: 2px 8px; border-radius: 20px; }
  .cat-header-right { display: flex; gap: 6px; }

  .btn-add {
    background: rgba(139,92,246,0.15); border: 1px solid rgba(139,92,246,0.3);
    border-radius: 8px; padding: 4px 8px; cursor: pointer; color: #a5b4fc;
    display: flex; align-items: center; gap: 4px; font-size: 13px; transition: background 0.2s;
  }
  .btn-add:hover { background: rgba(139,92,246,0.25); }

  .btn-del-cat {
    background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2);
    border-radius: 8px; padding: 4px 6px; cursor: pointer; color: #f87171; display: flex;
  }

  /* Form panel */
  .form-panel {
    background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px; padding: 16px; margin-bottom: 14px;
    animation: slideDown 0.2s ease;
  }
  @keyframes slideDown { from { opacity:0; transform:translateY(-6px); } to { opacity:1; transform:translateY(0); } }

  .form-row { display: flex; gap: 8px; align-items: flex-end; flex-wrap: wrap; }
  .form-group { display: flex; flex-direction: column; }
  .form-group.f-name { flex: 1 1 140px; }
  .form-group.f-desc { flex: 1 1 140px; }
  .form-group.f-url  { flex: 2 1 200px; }
  .form-group label { font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
  .form-group input {
    padding: 8px 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px; color: #e2e4e9; font-size: 14px; outline: none;
  }
  .form-group input::placeholder { color: #4b5563; }
  .form-group input:focus { border-color: rgba(139,92,246,0.5); }

  .color-row { display: flex; gap: 4px; align-items: center; flex-wrap: wrap; max-width: 140px; }
  .color-dot {
    width: 22px; height: 22px; border-radius: 50%; cursor: pointer;
    border: 2px solid transparent; transition: border 0.15s;
  }
  .color-dot.active { border-color: white; }

  .btn-primary {
    background: linear-gradient(135deg, #6366f1, #8b5cf6); border: none;
    border-radius: 8px; padding: 8px 14px; cursor: pointer; color: white;
    font-size: 13px; font-weight: 600; white-space: nowrap;
  }
  .btn-cancel {
    background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px; padding: 8px 10px; cursor: pointer; color: #9ca3af; display: flex; align-items: center;
  }

  /* Cards grid */
  .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 10px; }

  /* App card */
  .app-card {
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.07);
    border-radius: 12px; padding: 14px 16px; cursor: pointer;
    transition: all 0.2s ease; position: relative; display: flex; flex-direction: column; gap: 6px;
  }
  .app-card:hover {
    background: rgba(255,255,255,0.07); border-color: rgba(255,255,255,0.14);
    transform: translateY(-2px);
  }
  .app-card:active { transform: translateY(0); }

  .card-actions {
    position: absolute; top: 10px; right: 10px; display: none; gap: 4px; z-index: 2;
  }
  .app-card:hover .card-actions { display: flex; }

  .btn-edit, .btn-del {
    border: none; border-radius: 6px; padding: 4px 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;
  }
  .btn-edit { background: rgba(0,0,0,0.5); color: #c4c8d4; }
  .btn-del  { background: rgba(239,68,68,0.2); color: #f87171; }

  .card-body { display: flex; align-items: center; gap: 10px; flex: 1; }
  .card-icon {
    width: 36px; height: 36px; border-radius: 10px; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; font-weight: 700; color: white;
    transition: transform 0.1s;
  }
  .app-card:active .card-icon { transform: scale(0.92); }

  .card-text { flex: 1; min-width: 0; }
  .card-text .app-name { font-size: 15px; font-weight: 600; color: #e2e4e9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .card-text .app-desc { font-size: 12px; color: #6b7280; }

  .card-ext { flex-shrink: 0; color: #3b3f4a; transition: color 0.2s; }
  .app-card:hover .card-ext { color: var(--card-color, #a5b4fc); }

  .card-url {
    font-size: 11px; color: #3b3f4a; font-family: monospace;
    padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.05);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }

  /* Edit mode card */
  .app-card.editing { background: rgba(255,255,255,0.05); border-color: rgba(139,92,246,0.4); cursor: default; }
  .edit-actions { display: flex; gap: 6px; margin-top: 4px; }
  .edit-actions .btn-primary { flex: 1; padding: 7px; display: flex; align-items: center; justify-content: center; gap: 4px; }
  .edit-actions .btn-cancel { padding: 7px 10px; }

  /* Add category button */
  .btn-add-cat {
    width: 100%; margin-top: 8px; padding: 12px;
    background: rgba(255,255,255,0.03); border: 1.5px dashed rgba(255,255,255,0.12);
    border-radius: 12px; color: #6b7280; cursor: pointer; font-size: 14px;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    transition: all 0.2s;
  }
  .btn-add-cat:hover { border-color: rgba(139,92,246,0.35); color: #a5b4fc; }

  .cat-form {
    background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px; padding: 14px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-top: 8px;
  }
  .cat-form input.emoji-input {
    width: 42px; text-align: center; font-size: 18px; flex: none;
    padding: 8px 4px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px; color: #e2e4e9; outline: none;
  }
  .cat-form input.name-input {
    flex: 1 1 160px; padding: 8px 10px; background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #e2e4e9;
    font-size: 14px; outline: none;
  }
  .cat-form input::placeholder { color: #4b5563; }
  .cat-form input:focus { border-color: rgba(139,92,246,0.5); }

  .footer { text-align: center; color: #3b3f4a; font-size: 12px; margin-top: 40px; }

  svg { display: block; }

  .hidden { display: none; }
</style>
</head>
<body>

<div class="glow glow-1"></div>
<div class="glow glow-2"></div>
<div class="glow glow-3"></div>

<!-- Export Button -->
<button class="export-btn" id="exportBtn">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
    <polyline points="7 10 12 15 17 10"></polyline>
    <line x1="12" y1="15" x2="12" y2="3"></line>
  </svg>
  Export Data
</button>

<!-- Export Modal -->
<div id="exportModal" class="modal-overlay hidden">
  <div class="modal">
    <h2>Export Your Data</h2>
    <p>Copy this JSON data and save it somewhere safe. You can use it to restore your workspace or share it with others.</p>
    <textarea id="exportTextarea" readonly></textarea>
    <div class="modal-actions">
      <button class="btn-secondary" id="closeModal">Close</button>
      <button class="btn-primary" id="copyBtn">Copy to Clipboard</button>
    </div>
  </div>
</div>

<div class="container">
  <div class="header">
    <h1>Workspace Hub</h1>
    <p>Work apps, all in one place</p>
  </div>

  <div class="search-wrap">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
    <input type="text" id="searchInput" placeholder="Search your apps...">
  </div>

  <div id="categoriesContainer"></div>

  <div id="addCategoryArea"></div>

  <div class="footer">Hover over a card to edit or remove Â· Everything saves automatically</div>
</div>

<script>
// â”€â”€â”€ SVG helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SVG = {
  plus: `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
  x: `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
  pencil: `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`,
  trash: `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>`,
  ext: `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>`,
  check: `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`,
  folder: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>`,
};

// â”€â”€â”€ Data & state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COLORS = ["#3B82F6","#8B5CF6","#10B981","#F59E0B","#EF4444","#EC4899","#06B6D4","#84CC16","#F97316","#6366F1"];
const STORAGE_KEY = "workspace-hub-data";

const DEFAULT_DATA = [
  { id:"hr", name:"HR & People", emoji:"ðŸ‘¥", apps:[
    { id:1, name:"SuccessFactors", desc:"People Hub",        url:"https://performancemanager.successfactors.eu/sf/home?bplte_company=britishsugar&_s.crb=95xciufTHZwCzHYjKQSirdsvsM2zilknPWUDmjEX3Yo%3d", color:"#3B82F6" },
    { id:2, name:"Dimensions",     desc:"Holiday Booking",   url:"https://britishsugar-sso.prd.mykronos.com/wfd/home", color:"#8B5CF6" },
    { id:1770152691218, name:"SAP Concur", desc:"Claim Expenses", url:"https://eu2.concursolutions.com/nui/signin?targetURL=%2Fhome", color:"#EC4899" },
  ]},
  { id:"analytics", name:"Analytics & Data", emoji:"ðŸ“Š", apps:[
    { id:3, name:"Seeq",           desc:"Trends & Analytics", url:"https://britishsugar.seeq.tech/",          color:"#10B981" },
    { id:1770152509945, name:"Lost Opp", desc:"Lost Oppertunity Booking", url:"https://lop-prod.britishsugar.com/Operator", color:"#3B82F6" },
    { id:1770152601565, name:"FTR", desc:"Lab Results", url:"https://ftr-app.azurewebsites.net/login", color:"#84CC16" },
    { id:1770152828271, name:"QF/Chemical app", desc:"Add QF/LED and chemicals data", url:"https://script.google.com/macros/s/AKfycbwLLQJntWsBaEiA7FMa-u2AplGdxW7tNjAXIV0cwByz0EKDIlVnyS9Qate2ip_dIMVS/exec", color:"#06B6D4" },
  ]},
  { id:"general", name:"General", emoji:"ðŸ“Œ", apps:[
    { id:1770153056606, name:"HxGN", desc:"Create Work Orders", url:"https://eu1.eam.hxgnsmartcloud.com/web/base/logindisp?tenant=BRITISHSUGAR_PRD", color:"#EF4444" },
    { id:1770153139586, name:"SIC", desc:"Short Interval Control", url:"https://abfoods.sharepoint.com/sites/bsu-cantleyteamssite/Lists/Cantley%20Performance%20Actions/Short%20Interval%20Control.aspx?viewid=227be9ec-2f19-4264-847d-27472793f812&env=WebViewList&OR=Teams-HL&CT=1733960021665&clickparams=eyJBcHBOYW1lIjoiVGVhbXMtRGVza3RvcCIsIkFwcFZlcnNpb24iOiI0OS8yNDExMDExNTcyMiIsIkhhc0ZlZGVyYXRlZFVzZXIiOmZhbHNlfQ%3D%3D", color:"#F97316" },
    { id:1770153195640, name:"British Sugar Intranet", desc:"", url:"https://abfoods.sharepoint.com/sites/bsu-hub", color:"#84CC16" },
    { id:1770153282586, name:"Change Log", desc:"Plant change Log", url:"https://teams.microsoft.com/l/entity/26bc2873-6023-480c-a11b-76b66605ce8c/_djb2_msteams_prefix_2011203644?context=%7B%22channelId%22%3A%2219%3AyIxeEUzWyRK1PMTDiin__Or4MWFuK6Dhq2vAmFYv8741%40thread.tacv2%22%7D&tenantId=39c5be5d-2510-4eee-9ca0-197a6e89e482", color:"#06B6D4" },
    { id:1770153316288, name:"Shift Logs", desc:"", url:"https://teams.microsoft.com/l/entity/com.microsoft.teamspace.tab.planner/_djb2_msteams_prefix_898003600?context=%7B%22channelId%22%3A%2219%3AyIxeEUzWyRK1PMTDiin__Or4MWFuK6Dhq2vAmFYv8741%40thread.tacv2%22%7D&tenantId=39c5be5d-2510-4eee-9ca0-197a6e89e482", color:"#F59E0B" },
    { id:1770153412955, name:"Alcumus", desc:"Incident Reporting", url:"https://britishsugar.info-exchange.com/app/incidents/home", color:"#8B5CF6" },
    { id:1770153448285, name:"Ideas App", desc:"", url:"https://teams.microsoft.com/l/entity/a6b63365-31a4-4f43-92ec-710b71557af9/_djb2_msteams_prefix_2569765742?context=%7B%22chatId%22%3A%2219%3A9f7c1791d44744eca1ec1c5b572a1d9f%40thread.v2%22%2C%22contextType%22%3A%22chat%22%7D&tenantId=39c5be5d-2510-4eee-9ca0-197a6e89e482", color:"#10B981" },
    { id:1770153572299, name:"Ops Chat", desc:"Operational Communications Chat", url:"https://teams.microsoft.com/l/chat/19:9f7c1791d44744eca1ec1c5b572a1d9f@thread.v2/conversations?context=%7B%22contextType%22%3A%22chat%22%7D", color:"#10B981" },
  ] },
];

let categories = loadData();
let addingTo      = null;   // catId or null
let editingApp    = null;   // { catId, app } or null
let addingCat     = false;

function loadData() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(DEFAULT_DATA));
  } catch { return JSON.parse(JSON.stringify(DEFAULT_DATA)); }
}
function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(categories)); }

// â”€â”€â”€ Export functionality â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('exportBtn').addEventListener('click', () => {
  const data = localStorage.getItem(STORAGE_KEY) || JSON.stringify(categories, null, 2);
  document.getElementById('exportTextarea').value = data;
  document.getElementById('exportModal').classList.remove('hidden');
});

document.getElementById('closeModal').addEventListener('click', () => {
  document.getElementById('exportModal').classList.add('hidden');
});

document.getElementById('copyBtn').addEventListener('click', () => {
  const textarea = document.getElementById('exportTextarea');
  textarea.select();
  document.execCommand('copy');
  
  // Visual feedback
  const btn = document.getElementById('copyBtn');
  const originalText = btn.textContent;
  btn.textContent = 'âœ“ Copied!';
  setTimeout(() => {
    btn.textContent = originalText;
  }, 2000);
});

// Close modal when clicking outside
document.getElementById('exportModal').addEventListener('click', (e) => {
  if (e.target.id === 'exportModal') {
    document.getElementById('exportModal').classList.add('hidden');
  }
});

// â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  const search = document.getElementById("searchInput").value.toLowerCase();

  const filtered = categories.map(cat => ({
    ...cat,
    apps: cat.apps.filter(a => a.name.toLowerCase().includes(search) || a.desc.toLowerCase().includes(search))
  })).filter(cat => cat.apps.length > 0 || !search);

  document.getElementById("categoriesContainer").innerHTML = filtered.map(cat => renderCategory(cat)).join("");
  renderAddCategoryArea();

  // Re-attach listeners
  document.querySelectorAll(".btn-add[data-cat]").forEach(btn => {
    btn.addEventListener("click", () => { addingTo = (addingTo === btn.dataset.cat) ? null : btn.dataset.cat; render(); });
  });
  document.querySelectorAll(".btn-del-cat[data-cat]").forEach(btn => {
    btn.addEventListener("click", () => { categories = categories.filter(c => c.id !== btn.dataset.cat); saveData(); render(); });
  });
  document.querySelectorAll(".app-card[data-cat][data-app]").forEach(card => {
    card.addEventListener("click", (e) => {
      if (e.target.closest(".btn-edit, .btn-del, .card-actions")) return;
      const app = getApp(card.dataset.cat, card.dataset.app);
      if (app) window.open(app.url, "_blank", "noopener,noreferrer");
    });
  });
  document.querySelectorAll(".btn-edit[data-cat][data-app]").forEach(btn => {
    btn.addEventListener("click", (e) => { e.stopPropagation(); editingApp = { catId: btn.dataset.cat, app: { ...getApp(btn.dataset.cat, btn.dataset.app) } }; render(); });
  });
  document.querySelectorAll(".btn-del[data-cat][data-app]").forEach(btn => {
    btn.addEventListener("click", (e) => { e.stopPropagation(); removeApp(btn.dataset.cat, btn.dataset.app); });
  });

  // Form: add app
  const addForm = document.getElementById("addForm");
  if (addForm) {
    addForm.querySelector("#formName").addEventListener("input", e => formState.name = e.target.value);
    addForm.querySelector("#formDesc").addEventListener("input", e => formState.desc = e.target.value);
    addForm.querySelector("#formUrl").addEventListener("input", e => formState.url = e.target.value);
    addForm.querySelector("#formUrl").addEventListener("keydown", e => { if (e.key === "Enter") submitAdd(); });
    addForm.querySelectorAll(".color-dot").forEach(dot => {
      dot.addEventListener("click", () => { formState.color = dot.dataset.color; render(); });
    });
    addForm.querySelector("#btnSubmitAdd").addEventListener("click", submitAdd);
    addForm.querySelector("#btnCancelAdd").addEventListener("click", () => { addingTo = null; formState = { name:"", desc:"", url:"", color: COLORS[0] }; render(); });
  }

  // Form: edit app
  const editForm = document.getElementById("editForm");
  if (editForm && editingApp) {
    editForm.querySelector("#editName").addEventListener("input", e => editingApp.app.name = e.target.value);
    editForm.querySelector("#editDesc").addEventListener("input", e => editingApp.app.desc = e.target.value);
    editForm.querySelector("#editUrl").addEventListener("input", e => editingApp.app.url = e.target.value);
    editForm.querySelectorAll(".color-dot").forEach(dot => {
      dot.addEventListener("click", () => { editingApp.app.color = dot.dataset.color; render(); });
    });
    editForm.querySelector("#btnSaveEdit").addEventListener("click", submitEdit);
    editForm.querySelector("#btnCancelEdit").addEventListener("click", () => { editingApp = null; render(); });
  }

  // Add category
  const catFormEl = document.getElementById("catForm");
  if (catFormEl) {
    catFormEl.querySelector("#catEmoji").addEventListener("input", e => newCatState.emoji = e.target.value);
    catFormEl.querySelector("#catName").addEventListener("input", e => newCatState.name = e.target.value);
    catFormEl.querySelector("#catName").addEventListener("keydown", e => { if (e.key === "Enter") submitAddCat(); });
    catFormEl.querySelector("#btnCreateCat").addEventListener("click", submitAddCat);
    catFormEl.querySelector("#btnCancelCat").addEventListener("click", () => { addingCat = false; newCatState = { name:"", emoji:"ðŸ“" }; render(); });
  }
  const addCatBtn = document.getElementById("btnAddCat");
  if (addCatBtn) addCatBtn.addEventListener("click", () => { addingCat = true; render(); });
}

function renderCategory(cat) {
  const isAdding  = addingTo === cat.id;
  const showDel   = cat.apps.length === 0;

  return `
  <div class="category">
    <div class="cat-header">
      <div class="cat-header-left">
        <span class="emoji">${cat.emoji}</span>
        <span class="name">${escHtml(cat.name)}</span>
        <span class="count">${cat.apps.length}</span>
      </div>
      <div class="cat-header-right">
        <button class="btn-add" data-cat="${cat.id}">${SVG.plus} Add</button>
        ${showDel ? `<button class="btn-del-cat" data-cat="${cat.id}">${SVG.trash}</button>` : ""}
      </div>
    </div>

    ${isAdding ? renderAddForm(cat.id) : ""}

    <div class="cards-grid">
      ${cat.apps.map(app => renderCard(cat.id, app)).join("")}
    </div>
  </div>`;
}

function renderCard(catId, app) {
  if (editingApp && editingApp.catId === catId && editingApp.app.id === app.id) return renderEditCard(catId);

  return `
  <div class="app-card" data-cat="${catId}" data-app="${app.id}" style="--card-color:${app.color}">
    <div class="card-actions">
      <button class="btn-edit" data-cat="${catId}" data-app="${app.id}">${SVG.pencil}</button>
      <button class="btn-del"  data-cat="${catId}" data-app="${app.id}">${SVG.trash}</button>
    </div>
    <div class="card-body">
      <div class="card-icon" style="background:linear-gradient(135deg,${app.color},${app.color}bb); box-shadow:0 2px 8px ${app.color}44;">
        ${escHtml(app.name.charAt(0).toUpperCase())}
      </div>
      <div class="card-text">
        <div class="app-name">${escHtml(app.name)}</div>
        ${app.desc ? `<div class="app-desc">${escHtml(app.desc)}</div>` : ""}
      </div>
      <div class="card-ext">${SVG.ext}</div>
    </div>
    <div class="card-url">${escHtml(app.url.replace(/^https?:\/\//,""))}</div>
  </div>`;
}

function renderEditCard(catId) {
  const a = editingApp.app;
  return `
  <div class="app-card editing" id="editForm">
    <input style="padding:8px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e2e4e9;font-size:14px;outline:none;" id="editName" value="${escHtml(a.name)}" placeholder="Name" />
    <input style="padding:8px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e2e4e9;font-size:14px;outline:none;" id="editDesc" value="${escHtml(a.desc)}" placeholder="Description" />
    <input style="padding:8px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e2e4e9;font-size:14px;outline:none;" id="editUrl" value="${escHtml(a.url)}" placeholder="URL" />
    <div class="color-row">${COLORS.map(c=>`<div class="color-dot ${a.color===c?"active":""}" data-color="${c}" style="background:${c}"></div>`).join("")}</div>
    <div class="edit-actions">
      <button class="btn-primary" id="btnSaveEdit">${SVG.check} Save</button>
      <button class="btn-cancel" id="btnCancelEdit">${SVG.x}</button>
    </div>
  </div>`;
}

function renderAddForm(catId) {
  return `
  <div class="form-panel" id="addForm">
    <div class="form-row">
      <div class="form-group f-name">
        <label>App Name *</label>
        <input id="formName" value="${escHtml(formState.name)}" placeholder="e.g. Slack" />
      </div>
      <div class="form-group f-desc">
        <label>Description</label>
        <input id="formDesc" value="${escHtml(formState.desc)}" placeholder="e.g. Messaging" />
      </div>
      <div class="form-group f-url">
        <label>URL *</label>
        <input id="formUrl" value="${escHtml(formState.url)}" placeholder="e.g. slack.com" />
      </div>
      <div style="display:flex;gap:6px;align-items:flex-end;">
        <div class="color-row">${COLORS.map(c=>`<div class="color-dot ${formState.color===c?"active":""}" data-color="${c}" style="background:${c}"></div>`).join("")}</div>
        <button class="btn-primary" id="btnSubmitAdd">Add</button>
        <button class="btn-cancel" id="btnCancelAdd">${SVG.x}</button>
      </div>
    </div>
  </div>`;
}

function renderAddCategoryArea() {
  const el = document.getElementById("addCategoryArea");
  if (addingCat) {
    el.innerHTML = `
    <div class="cat-form" id="catForm">
      <input class="emoji-input" id="catEmoji" value="${escHtml(newCatState.emoji)}" placeholder="ðŸ“" />
      <input class="name-input" id="catName" value="${escHtml(newCatState.name)}" placeholder="Category name" />
      <button class="btn-primary" id="btnCreateCat">Create</button>
      <button class="btn-cancel" id="btnCancelCat">${SVG.x}</button>
    </div>`;
  } else {
    el.innerHTML = `<button class="btn-add-cat" id="btnAddCat">${SVG.folder} Add Category</button>`;
  }
}

// â”€â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let formState   = { name:"", desc:"", url:"", color: COLORS[0] };
let newCatState = { name:"", emoji:"ðŸ“" };

function submitAdd() {
  if (!formState.name || !formState.url) return;
  const url = formState.url.startsWith("http") ? formState.url : "https://" + formState.url;
  const cat = categories.find(c => c.id === addingTo);
  if (cat) cat.apps.push({ id: Date.now(), name: formState.name, desc: formState.desc, url, color: formState.color });
  saveData();
  addingTo  = null;
  formState = { name:"", desc:"", url:"", color: COLORS[0] };
  render();
}

function submitEdit() {
  if (!editingApp) return;
  const url = editingApp.app.url.startsWith("http") ? editingApp.app.url : "https://" + editingApp.app.url;
  const cat = categories.find(c => c.id === editingApp.catId);
  if (cat) {
    const idx = cat.apps.findIndex(a => a.id === editingApp.app.id);
    if (idx > -1) cat.apps[idx] = { ...editingApp.app, url };
  }
  saveData();
  editingApp = null;
  render();
}

function removeApp(catId, appId) {
  const cat = categories.find(c => c.id === catId);
  if (cat) cat.apps = cat.apps.filter(a => String(a.id) !== String(appId));
  saveData();
  render();
}

function submitAddCat() {
  if (!newCatState.name) return;
  categories.push({ id: Date.now().toString(), name: newCatState.name, emoji: newCatState.emoji, apps: [] });
  saveData();
  addingCat   = false;
  newCatState = { name:"", emoji:"ðŸ“" };
  render();
}

function getApp(catId, appId) {
  const cat = categories.find(c => c.id === catId);
  return cat ? cat.apps.find(a => String(a.id) === String(appId)) : null;
}

function escHtml(s) { return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById("searchInput").addEventListener("input", render);
render();
</script>

</body>
</html>
